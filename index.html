<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>AI Snakeit | Master Edition</title>
    <style>
        :root {
            --bg: #020617; --panel: #0f172a; --text: #f8fafc;
            --accent: #38bdf8; --snake: #22c55e; --food: #f43f5e;
        }
        [data-theme="day"] {
            --bg: #f1f5f9; --panel: #ffffff; --text: #0f172a;
            --accent: #0284c7; --snake: #16a34a; --food: #e11d48;
        }
        body { 
            margin: 0; background: var(--bg); color: var(--text); 
            font-family: sans-serif; display: flex; align-items: center; 
            justify-content: center; height: 100vh; overflow: hidden;
            transition: background 0.3s;
        }
        .container { 
            position: relative; width: 360px; background: var(--panel); 
            border-radius: 24px; padding: 20px; box-shadow: 0 15px 35px rgba(0,0,0,0.3);
        }
        canvas { background: #000; border-radius: 12px; display: block; margin: 0 auto; touch-action: none; }
        
        /* Home/Over Screens */
        .screen {
            position: absolute; inset: 20px; background: var(--panel);
            z-index: 10; display: flex; flex-direction: column;
            align-items: center; justify-content: center; border-radius: 12px;
        }

        /* Mobile Controls */
        .mobile-controls {
            display: none; grid-template-columns: repeat(3, 1fr);
            gap: 10px; margin-top: 20px;
        }
        .btn {
            background: rgba(148, 163, 184, 0.1); border: 1px solid var(--accent);
            border-radius: 12px; height: 50px; display: flex;
            align-items: center; justify-content: center; font-size: 1.5rem;
            color: var(--accent); cursor: pointer; user-select: none;
        }
        @media (max-width: 600px) { .mobile-controls { display: grid; } }

        .hud { display: flex; justify-content: space-between; margin-bottom: 10px; font-family: monospace; }
        button.start-btn { padding: 12px 30px; background: var(--accent); border: none; border-radius: 8px; color: white; font-weight: bold; cursor: pointer; }
        .mode-toggle { position: absolute; top: 10px; right: 10px; cursor: pointer; background: none; border: none; font-size: 1.2rem; }
    </style>
</head>
<body data-theme="night">

<div class="container" id="gameBox">
    <button class="mode-toggle" onclick="toggleTheme()" id="themeBtn">‚òÄÔ∏è</button>
    <div class="hud">
        <div id="scoreTxt">SCORE: 000</div>
        <div id="speedTxt">SPD: 1x</div>
    </div>

    <canvas id="c" width="320" height="320"></canvas>
    
    <div class="mobile-controls">
        <div></div><div class="btn" onclick="handleInput('ArrowUp')">‚ñ≤</div><div></div>
        <div class="btn" onclick="handleInput('ArrowLeft')">‚óÄ</div>
        <div class="btn" onclick="handleInput('ArrowDown')">‚ñº</div>
        <div class="btn" onclick="handleInput('ArrowRight')">‚ñ∂</div>
    </div>

    <div id="homeScreen" class="screen">
        <h1 style="color:var(--accent); margin-bottom:5px;">AI SNAKEIT</h1>
        <p style="opacity:0.6; margin-bottom:20px;">BEST: <span id="hiVal">0</span></p>
        <button class="start-btn" onclick="startGame()">INITIALIZE</button>
    </div>

    <div id="overScreen" class="screen" style="display:none">
        <h2 style="color:var(--food)">CRASHED</h2>
        <button class="start-btn" onclick="startGame()">REBOOT</button>
    </div>
</div>

<script>
const canvas = document.getElementById("c"), ctx = canvas.getContext("2d");
let score=0, hiScore=localStorage.getItem("ais_hi")||0, gameRunning=false;
let snake=[{x:8,y:8}], food={x:5,y:5}, dx=0, dy=-1, currentSpeed=150;
let ghostTrails = []; // Array to hold the ghosting effect

function toggleTheme() {
    const isNight = document.body.getAttribute("data-theme") === "night";
    document.body.setAttribute("data-theme", isNight ? "day" : "night");
    document.getElementById("themeBtn").innerText = isNight ? "üåô" : "‚òÄÔ∏è";
}

function startGame() {
    document.querySelectorAll('.screen').forEach(s=>s.style.display='none');
    score=0; snake=[{x:8,y:8}]; dx=0; dy=-1; currentSpeed=150; ghostTrails=[];
    gameRunning=true; runLoop();
}

function handleInput(key) {
    if(!gameRunning) return;
    if(key==="ArrowUp" && dy===0) { dx=0; dy=-1; }
    if(key==="ArrowDown" && dy===0) { dx=0; dy=1; }
    if(key==="ArrowLeft" && dx===0) { dx=-1; dy=0; }
    if(key==="ArrowRight" && dx===0) { dx=1; dy=0; }
}

function update() {
    const head = {x: snake[0].x+dx, y: snake[0].y+dy};
    
    if(head.x<0||head.x>=16||head.y<0||head.y>=16||snake.some(s=>s.x===head.x&&s.y===head.y)) {
        gameRunning=false;
        document.getElementById("overScreen").style.display='flex';
        if(score > hiScore) { hiScore=score; localStorage.setItem("ais_hi", hiScore); document.getElementById("hiVal").innerText=hiScore; }
        return;
    }

    // Capture ghost trail position
    ghostTrails.push({ body: [...snake], alpha: 0.4 });
    if(ghostTrails.length > 5) ghostTrails.shift();

    snake.unshift(head);
    if(head.x===food.x && head.y===food.y) {
        score+=10;
        food={x:Math.floor(Math.random()*16), y:Math.floor(Math.random()*16)};
        currentSpeed = Math.max(60, 150 - (Math.floor(score/20)*10));
    } else { snake.pop(); }
}

function draw() {
    const isNight = document.body.getAttribute("data-theme") === 'night';
    ctx.fillStyle = isNight ? "#000" : "#fff";
    ctx.fillRect(0,0,320,320);

    // Draw Ghost Trails
    ghostTrails.forEach((trail, idx) => {
        trail.alpha -= 0.05;
        ctx.globalAlpha = Math.max(0, trail.alpha);
        ctx.fillStyle = getComputedStyle(document.body).getPropertyValue('--accent');
        trail.body.forEach(s => ctx.fillRect(s.x*20+2, s.y*20+2, 15, 15));
    });
    ctx.globalAlpha = 1.0;

    // Draw Snake
    snake.forEach((s,i) => {
        ctx.fillStyle = i===0 ? getComputedStyle(document.body).getPropertyValue('--accent') : getComputedStyle(document.body).getPropertyValue('--snake');
        ctx.fillRect(s.x*20, s.y*20, 19, 19);
    });

    // Draw Food
    ctx.fillStyle = getComputedStyle(document.body).getPropertyValue('--food');
    ctx.beginPath(); ctx.arc(food.x*20+10, food.y*20+10, 8, 0, 7); ctx.fill();

    document.getElementById("scoreTxt").innerText = `SCORE: ${score}`;
    document.getElementById("speedTxt").innerText = `SPD: ${(150/currentSpeed).toFixed(1)}x`;
}

function runLoop() {
    if(!gameRunning) return;
    update(); draw();
    setTimeout(runLoop, currentSpeed);
}

window.addEventListener("keydown", e => handleInput(e.key));
</script>
</body>
</html>