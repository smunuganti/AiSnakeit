<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="description" content="AI Snakeit - Realistic Evolutionary Snake Arcade Game">
    <title>AI Snakeit | Master Edition</title>
    <style>
        :root {
            --bg: #020617; --panel: #0f172a; --text: #f8fafc;
            --accent: #38bdf8; --snake-head: #4ade80; --snake-body: #16a34a; --food: #f43f5e;
            --grid: rgba(56, 189, 248, 0.05); --gold: #fbbf24;
        }
        [data-theme="day"] {
            --bg: #f1f5f9; --panel: #ffffff; --text: #0f172a;
            --accent: #0284c7; --snake-head: #22c55e; --snake-body: #15803d; --food: #e11d48;
            --grid: rgba(0, 0, 0, 0.05);
        }
        body { 
            margin: 0; background: var(--bg); color: var(--text); 
            font-family: 'Segoe UI', Tahoma, sans-serif; display: flex; 
            align-items: center; justify-content: center; height: 100vh; 
            overflow: hidden; transition: background 0.4s ease;
        }

        .container { 
            position: relative; width: 360px; background: var(--panel); 
            border-radius: 24px; padding: 20px; box-shadow: 0 15px 35px rgba(0,0,0,0.3);
            border: 2px solid var(--accent);
            background-image: radial-gradient(var(--grid) 2px, transparent 2px);
            background-size: 20px 20px; transition: background 0.4s ease;
        }

        canvas { background: #000; border-radius: 12px; display: block; margin: 0 auto; touch-action: none; border: 1px solid rgba(255,255,255,0.1); }
        
        .screen {
            position: absolute; inset: 0px; background: var(--panel);
            z-index: 10; display: flex; flex-direction: column;
            align-items: center; justify-content: center; border-radius: 22px;
            background-image: linear-gradient(135deg, rgba(34, 197, 94, 0.03) 25%, transparent 25%), 
                              linear-gradient(225deg, rgba(34, 197, 94, 0.03) 25%, transparent 25%);
            background-size: 40px 40px; transition: background 0.4s ease;
        }

        .snake-logo {
            font-size: 3.5rem; margin-bottom: 10px; filter: drop-shadow(0 0 10px var(--snake-head));
            animation: slither 2.5s infinite ease-in-out;
        }
        @keyframes slither {
            0%, 100% { transform: translateY(0) rotate(-8deg); }
            50% { transform: translateY(-15px) rotate(8deg); }
        }

        .theme-switch-container {
            display: flex; align-items: center; gap: 10px; margin-bottom: 25px;
            padding: 8px 16px; background: rgba(148, 163, 184, 0.2); border-radius: 20px;
            border: 1px solid var(--accent);
        }
        .switch { position: relative; display: inline-block; width: 44px; height: 22px; }
        .switch input { opacity: 0; width: 0; height: 0; }
        .slider { position: absolute; cursor: pointer; inset: 0; background-color: #475569; transition: .4s; border-radius: 34px; }
        .slider:before { position: absolute; content: ""; height: 16px; width: 16px; left: 3px; bottom: 3px; background-color: white; transition: .4s; border-radius: 50%; }
        input:checked + .slider { background-color: var(--snake-head); }
        input:checked + .slider:before { transform: translateX(22px); }

        #lvlUpMsg {
            position: absolute; top: 40%; left: 50%; transform: translate(-50%, -50%);
            font-weight: 900; font-size: 2.2rem; color: var(--gold);
            pointer-events: none; opacity: 0; transition: 0.3s; z-index: 5;
            text-shadow: 0 0 20px var(--gold);
        }

        .stats-box { text-align: center; margin-bottom: 20px; font-family: 'Courier New', monospace; }
        .stat-line { font-size: 0.9rem; margin: 5px 0; color: var(--text); }
        .stat-val { font-weight: bold; color: var(--accent); }

        .mobile-controls { display: none; grid-template-columns: repeat(3, 1fr); gap: 10px; margin-top: 20px; }
        .btn { background: rgba(148, 163, 184, 0.1); border: 1px solid var(--accent); border-radius: 12px; height: 55px; display: flex; align-items: center; justify-content: center; font-size: 1.5rem; color: var(--accent); cursor: pointer; -webkit-tap-highlight-color: transparent; }
        @media (max-width: 600px) { .mobile-controls { display: grid; } }
        
        .hud { display: flex; justify-content: space-between; margin-bottom: 10px; font-family: 'Courier New', monospace; font-size: 1.2rem; font-weight: bold;}
        
        button.start-btn { 
            padding: 14px 45px; background: var(--accent); border: none; border-radius: 12px; 
            color: white; font-weight: 900; cursor: pointer; font-size: 1.1rem; 
            box-shadow: 0 4px 15px rgba(56, 189, 248, 0.4); transition: transform 0.1s;
        }
        button.start-btn:active { transform: scale(0.95); }

        .shake { animation: shake 0.2s 2; }
        @keyframes shake { 0%,100%{transform:translateX(0)} 25%{transform:translateX(-5px)} 75%{transform:translateX(5px)} }
    </style>
</head>
<body data-theme="night">

<div class="container" id="gameBox">
    <div id="lvlUpMsg">EVOLUTION!</div>
    <div class="hud">
        <div id="scoreTxt">000</div>
        <div id="speedTxt">SPD: 0.2x</div>
    </div>

    <canvas id="c" width="320" height="320"></canvas>
    
    <div class="mobile-controls">
        <div></div><div class="btn" onclick="handleInput('ArrowUp')">‚ñ≤</div><div></div>
        <div class="btn" onclick="handleInput('ArrowLeft')">‚óÄ</div>
        <div class="btn" onclick="handleInput('ArrowDown')">‚ñº</div>
        <div class="btn" onclick="handleInput('ArrowRight')">‚ñ∂</div>
    </div>

    <div id="homeScreen" class="screen">
        <div class="snake-logo">üêç</div>
        <h1 style="color:var(--accent); margin:0; font-size: 2.4rem; letter-spacing: 2px;">AI SNAKEIT</h1>
        <p style="margin-top:0; opacity:0.5; font-size:0.8rem; margin-bottom:20px;">DEPLOYMENT READY v3.0</p>
        
        <div class="theme-switch-container">
            <span>üåô</span>
            <label class="switch">
                <input type="checkbox" id="themeCheckbox" onchange="toggleTheme()">
                <span class="slider"></span>
            </label>
            <span>‚òÄÔ∏è</span>
        </div>

        <div class="stats-box">
            <div class="stat-line" id="lastScoreContainer" style="display:none;">LAST MISSION: <span class="stat-val" id="lastScoreVal">0</span></div>
            <div class="stat-line">WORLD RECORD: <span class="stat-val" style="color:#fbbf24" id="hiVal">0</span></div>
        </div>

        <button class="start-btn" onclick="startGame()" id="mainBtn">INITIALIZE</button>
    </div>
</div>

<script>
    const canvas = document.getElementById("c"), ctx = canvas.getContext("2d");
    let score=0, hiScore=localStorage.getItem("ais_hi")||0, gameRunning=false;
    let snake=[{x:8,y:8}], food={x:5,y:5}, dx=0, dy=-1;
    let currentSpeed = 500; // 0.2x start
    let tongueOut = false, hiBeatenAnnounced = false;
    let dust = [];

    const audio = new (window.AudioContext || window.webkitAudioContext)();
    function playSound(freq, type, duration) {
        if (audio.state === 'suspended') return;
        const osc = audio.createOscillator();
        const gain = audio.createGain();
        osc.type = type;
        osc.frequency.setValueAtTime(freq, audio.currentTime);
        gain.gain.setValueAtTime(0.05, audio.currentTime);
        gain.gain.exponentialRampToValueAtTime(0.01, audio.currentTime + duration);
        osc.connect(gain); gain.connect(audio.destination);
        osc.start(); osc.stop(audio.currentTime + duration);
    }

    const skinTiers = [
        ["#4ade80", "#16a34a"], ["#38bdf8", "#0284c7"], ["#c084fc", "#9333ea"],
        ["#f472b6", "#db2777"], ["#fbbf24", "#d97706"], ["#f87171", "#dc2626"]
    ];

    document.getElementById("hiVal").innerText = hiScore;
    for(let i=0; i<15; i++) dust.push({x: Math.random()*320, y: Math.random()*320, s: Math.random()*2});

    function toggleTheme() {
        const isDay = document.getElementById("themeCheckbox").checked;
        document.body.setAttribute("data-theme", isDay ? "day" : "night");
    }

    function startGame() {
        if (audio.state === 'suspended') audio.resume();
        document.getElementById("homeScreen").style.display = 'none';
        score=0; snake=[{x:8,y:8}]; dx=0; dy=-1; currentSpeed=500;
        hiBeatenAnnounced = false;
        gameRunning=true; 
        runLoop();
    }

    function handleInput(key) {
        if(!gameRunning) return;
        if(key==="ArrowUp" && dy===0) { dx=0; dy=-1; }
        if(key==="ArrowDown" && dy===0) { dx=0; dy=1; }
        if(key==="ArrowLeft" && dx===0) { dx=-1; dy=0; }
        if(key==="ArrowRight" && dx===0) { dx=1; dy=0; }
    }

    function update() {
        const head = {x: snake[0].x+dx, y: snake[0].y+dy};
        if(head.x<0||head.x>=16||head.y<0||head.y>=16||snake.some(s=>s.x===head.x&&s.y===head.y)) {
            gameRunning = false;
            triggerGameOver();
            return;
        }

        tongueOut = (Math.abs(head.x - food.x) + Math.abs(head.y - food.y)) < 4 || Math.random() < 0.1;

        snake.unshift(head);
        if(head.x===food.x && head.y===food.y) {
            score+=10;
            playSound(440, 'sine', 0.1);
            food={x:Math.floor(Math.random()*16), y:Math.floor(Math.random()*16)};
            
            if(score > hiScore && hiScore > 0 && !hiBeatenAnnounced) {
                hiBeatenAnnounced = true;
                playSound(880, 'triangle', 0.3);
            }

            if(score % 50 === 0) {
                currentSpeed = Math.max(60, currentSpeed - 85);
                showLevelUp();
                playSound(660, 'square', 0.2);
            }
        } else { snake.pop(); }
        dust.forEach(p => { p.y += 0.2; if(p.y > 320) p.y = 0; });
    }

    function showLevelUp() {
        const msg = document.getElementById("lvlUpMsg");
        msg.style.opacity = "1";
        setTimeout(() => msg.style.opacity = "0", 1000);
    }

    function draw() {
        const isNight = document.body.getAttribute("data-theme") === 'night';
        ctx.fillStyle = isNight ? "#000" : "#fff";
        ctx.fillRect(0,0,320,320);

        ctx.strokeStyle = getComputedStyle(document.body).getPropertyValue('--grid');
        ctx.lineWidth = 1;
        for(let i=0; i<=320; i+=20) {
            ctx.beginPath(); ctx.moveTo(i,0); ctx.lineTo(i,320); ctx.stroke();
            ctx.beginPath(); ctx.moveTo(0,i); ctx.lineTo(320,i); ctx.stroke();
        }

        ctx.fillStyle = isNight ? "rgba(255,255,255,0.1)" : "rgba(0,0,0,0.05)";
        dust.forEach(p => ctx.fillRect(p.x, p.y, p.s, p.s));

        const tierIndex = Math.min(skinTiers.length - 1, Math.floor(score / 50));
        const [headColor, bodyColor] = skinTiers[tierIndex];

        snake.forEach((s, i) => {
            const isHead = i === 0;
            const size = Math.max(12, 19 - (i * 0.4));
            const centerX = s.x * 20 + 10, centerY = s.y * 20 + 10;
            let grad = ctx.createRadialGradient(centerX-2, centerY-2, 2, centerX, centerY, 10);
            grad.addColorStop(0, isHead ? headColor : bodyColor);
            grad.addColorStop(1, "#000"); 
            ctx.fillStyle = grad;
            ctx.beginPath(); ctx.roundRect(s.x*20+(20-size)/2, s.y*20+(20-size)/2, size, size, isHead?10:5); ctx.fill();

            if(isHead) {
                if(tongueOut) {
                    ctx.strokeStyle = "#f43f5e"; ctx.lineWidth = 2;
                    ctx.beginPath(); ctx.moveTo(centerX+dx*8, centerY+dy*8); ctx.lineTo(centerX+dx*15, centerY+dy*15); ctx.stroke();
                }
                ctx.fillStyle = "white";
                if(dx!==0) { ctx.fillRect(s.x*20+12*dx+8, s.y*20+5, 3, 3); ctx.fillRect(s.x*20+12*dx+8, s.y*20+12, 3, 3); }
                else { ctx.fillRect(s.x*20+5, s.y*20+12*dy+8, 3, 3); ctx.fillRect(s.x*20+12, s.y*20+12*dy+8, 3, 3); }
            }
        });

        const pulse = Math.sin(Date.now() / 200) * 2;
        ctx.fillStyle = getComputedStyle(document.body).getPropertyValue('--food');
        ctx.shadowBlur = 10; ctx.shadowColor = ctx.fillStyle;
        ctx.beginPath(); ctx.arc(food.x*20+10, food.y*20+10, 7+pulse, 0, 7); ctx.fill();
        ctx.shadowBlur = 0;

        document.getElementById("scoreTxt").innerText = score.toString().padStart(3, '0');
        document.getElementById("speedTxt").innerText = `SPD: ${(100/currentSpeed).toFixed(1)}x`;
    }

    function triggerGameOver() {
        if(score > hiScore) { hiScore = score; localStorage.setItem("ais_hi", hiScore); document.getElementById("hiVal").innerText = hiScore; }
        document.getElementById("lastScoreVal").innerText = score;
        document.getElementById("lastScoreContainer").style.display = 'block';
        document.getElementById("gameBox").classList.add("shake");
        playSound(150, 'sawtooth', 0.5);
        setTimeout(() => { document.getElementById("homeScreen").style.display = 'flex'; document.getElementById("gameBox").classList.remove("shake"); }, 200);
    }

    function runLoop() {
        if(!gameRunning) return;
        update(); draw();
        setTimeout(runLoop, currentSpeed);
    }
    window.addEventListener("keydown", e => handleInput(e.key));
</script>
</body>
</html>